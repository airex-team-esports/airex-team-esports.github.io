<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>AX Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { background: #050505; color: #fff; font-family: 'Montserrat', sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
    h1, h2, h3 { font-family: 'Orbitron', sans-serif; color: #e91e63; margin-top: 0; }
    .panel { background: #111; padding: 20px; border: 1px solid #333; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
    label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 12px; margin: 5px 0; background: #222; border: 1px solid #444; color: #fff; border-radius: 6px; box-sizing: border-box; }
    button { background: #e91e63; color: white; border: none; padding: 12px 20px; cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; width: 100%; border-radius: 6px; margin-top: 10px; font-weight: bold; transition: 0.2s; }
    button:hover { background: #ff0060; transform: scale(1.02); }
    button.delete { background: #ff3333; width: auto; padding: 5px 12px; font-size: 10px; margin: 0; }
    .player-item { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 12px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #333; }
    .loader { text-align: center; color: #e91e63; font-family: 'Orbitron'; display: none; }
  </style>
</head>
<body>
  <div id="loginOverlay" style="position: fixed; inset: 0; background: #050505; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;">
    <div class="panel" style="max-width: 350px; width: 100%; text-align: center;">
        <h2 style="margin-bottom: 20px;">üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
        <input type="password" id="adminPass" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="text-align: center; margin-bottom: 15px;">
        <button onclick="checkPassword()">–í–û–ô–¢–ò</button>
        <p id="loginError" style="color: #ff3333; font-size: 12px; margin-top: 10px; display: none;">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!</p>
    </div>
</div>

  <h1>AIREX // ADMIN</h1>

  <div class="panel">
    <h2>‚ö° –°–ª–µ–¥—É—é—â–∏–π –º–∞—Ç—á</h2>
    <label>–ò–º—è —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</label>
    <input type="text" id="enemyName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: NAVI">
    <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</label>
    <input type="datetime-local" id="matchDate">
    <button onclick="saveMatch()">–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä</button>
  </div>

  <div class="panel">
    <h2>üë• –°–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã</h2>
    <div id="loading" class="loader">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞...</div>
    <div id="rosterList"></div> 

    <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
    
    <label>–¢–∏–ø —Å–æ—Å—Ç–∞–≤–∞</label>
    <select id="rosterType">
        <option value="roster">–û—Å–Ω–æ–≤–Ω–æ–π —Å–æ—Å—Ç–∞–≤ (Main)</option>
        <option value="reserve">–ó–∞–ø–∞—Å–Ω—ã–µ (Reserve)</option>
    </select>

    <h3>–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</h3>
    <input type="text" id="pNick" placeholder="–ù–∏–∫–Ω–µ–π–º">
    <input type="text" id="pRole" placeholder="–†–æ–ª—å">
    <input type="text" id="pQuote" placeholder="–¶–∏—Ç–∞—Ç–∞">
    <input type="text" id="pImg" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ">
    
    <div style="display:flex; gap:10px;">
        <div style="flex:1"><label>–°–∫–∏–ª–ª</label><input type="text" id="s1Name" placeholder="AIM"></div>
        <div style="flex:1"><label>%</label><input type="number" id="s1Val" placeholder="98"></div>
    </div>
    <button onclick="addPlayer()">+ –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
  </div>
  
  <div class="panel">
    <h2>üèÜ –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π</h2>
    <div id="historyAdminList" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px; border: 1px solid #333; padding: 10px;"></div>
    
    <label>–°–æ–ø–µ—Ä–Ω–∏–∫</label>
    <input type="text" id="hEnemy" placeholder="–¢–ï–ì –°–æ–ø–µ—Ä–Ω–∏–∫–∞">
    <label>–¢—É—Ä–Ω–∏—Ä</label>
    <input type="text" id="hTour" placeholder="Winter Cup">
    
    <div style="display:flex; gap:10px;">
        <div style="flex:1"><label>–ù–∞—à —Å—á–µ—Ç</label><input type="number" id="hOur"></div>
        <div style="flex:1"><label>–ò—Ö —Å—á–µ—Ç</label><input type="number" id="hEnemyScore"></div>
    </div>
    
    <label>–°–∫—Ä–∏–Ω—à–æ—Ç (URL)</label>
    <input type="text" id="hScreenshot" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç">
    
    <button onclick="addMatchToHistory()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDVFYaxAtzEi5zF8yi_ORJQYL66wQa-gpE", 
      authDomain: "airexsite.firebaseapp.com",
      projectId: "airexsite",
      storageBucket: "airexsite.firebasestorage.app",
      messagingSenderId: "276640665598",
      appId: "1:276640665598:web:d7400bd5962995efb43aaf"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 1. –°–û–•–†–ê–ù–ï–ù–ò–ï –ú–ê–¢–ß–ê
    window.saveMatch = async () => {
      const enemy = document.getElementById('enemyName').value;
      const date = document.getElementById('matchDate').value;
      if(!enemy || !date) return alert("–ó–∞–ø–æ–ª–Ω–∏ –¥–∞–Ω–Ω—ã–µ –º–∞—Ç—á–∞!");
      try {
        await setDoc(doc(db, "siteData", "match"), { enemy, date });
        alert('‚úÖ –ú–∞—Ç—á –æ–±–Ω–æ–≤–ª–µ–Ω!');
      } catch (e) { alert(e.message); }
    };

    // 2. –°–ü–ò–°–û–ö –ò–ì–†–û–ö–û–í (–°–õ–£–®–ê–¢–ï–õ–¨)
    // –°–ª—É—à–∞–µ–º —Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–æ—Å—Ç–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏ —Ä–µ–∑–µ—Ä–≤ –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏)
    onSnapshot(doc(db, "siteData", "roster"), (docSnap) => {
        const rosterDiv = document.getElementById('rosterList');
        rosterDiv.innerHTML = '';
        if (docSnap.exists() && docSnap.data().list) {
            docSnap.data().list.forEach(p => {
                const el = document.createElement('div');
                el.className = 'player-item';
                el.innerHTML = `<div><b>${p.nick}</b> <span>${p.role}</span></div>
                                <button class="delete" onclick="removePlayer('${p.nick}', 'roster')">–£–¥–∞–ª–∏—Ç—å</button>`;
                rosterDiv.appendChild(el);
            });
        }
    });

    // 3. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ö–ê
    window.addPlayer = async () => {
        const nick = document.getElementById('pNick').value;
        const role = document.getElementById('pRole').value;
        const type = document.getElementById('rosterType').value;
        if(!nick || !role) return alert("–£–∫–∞–∂–∏ –Ω–∏–∫ –∏ —Ä–æ–ª—å!");

        const newPlayer = {
            nick, role,
            quote: document.getElementById('pQuote').value || "No quote",
            img: document.getElementById('pImg').value || "https://via.placeholder.com/200",
            skill: { 
                name: document.getElementById('s1Name').value || "SKILL", 
                val: document.getElementById('s1Val').value || 50 
            }
        };

        try {
            const docRef = doc(db, "siteData", type);
            const snap = await getDoc(docRef);
            let list = (snap.exists() && snap.data().list) ? snap.data().list : [];
            list.push(newPlayer);
            await setDoc(docRef, { list });
            alert(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –≤ ${type}!`);
            document.getElementById('pNick').value = '';
        } catch (e) { alert(e.message); }
    };

    // 4. –£–î–ê–õ–ï–ù–ò–ï –ò–ì–†–û–ö–ê
    window.removePlayer = async (nickToDelete, type) => {
        if(!confirm(`–£–¥–∞–ª–∏—Ç—å ${nickToDelete}?`)) return;
        try {
            const docRef = doc(db, "siteData", type);
            const snap = await getDoc(docRef);
            if (snap.exists()) {
                const newList = snap.data().list.filter(p => p.nick !== nickToDelete);
                await setDoc(docRef, { list: newList });
            }
        } catch (e) { alert(e.message); }
    };
  
    // 5. –î–û–ë–ê–í–õ–ï–ù–ò–ï –í –ò–°–¢–û–†–ò–Æ
    window.addMatchToHistory = async () => {
        const enemy = document.getElementById('hEnemy').value;
        const tour = document.getElementById('hTour').value;
        const ourS = document.getElementById('hOur').value;
        const enemyS = document.getElementById('hEnemyScore').value;
        const screen = document.getElementById('hScreenshot').value;

        if(!enemy || ourS === "" || enemyS === "") return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è –∏—Å—Ç–æ—Ä–∏–∏!");

        const newMatch = {
            id: Date.now(),
            enemy, tournament: tour || "Match",
            ourScore: parseInt(ourS),
            enemyScore: parseInt(enemyS),
            screenshot: screen || null
        };

        try {
            const docRef = doc(db, "siteData", "history");
            const snap = await getDoc(docRef);
            let list = (snap.exists() && snap.data().list) ? snap.data().list : [];
            list.push(newMatch);
            await setDoc(docRef, { list });
            alert("‚úÖ –ú–∞—Ç—á –¥–æ–±–∞–≤–ª–µ–Ω!");
            document.getElementById('hEnemy').value = '';
            document.getElementById('hScreenshot').value = '';
        } catch (e) { alert(e.message); }
    };

    // 6. –°–ü–ò–°–û–ö –ò–°–¢–û–†–ò–ò (–°–õ–£–®–ê–¢–ï–õ–¨)
    onSnapshot(doc(db, "siteData", "history"), (docSnap) => {
        const container = document.getElementById('historyAdminList');
        if (docSnap.exists() && container) {
            const matches = docSnap.data().list || [];
            container.innerHTML = matches.map(m => `
                <div style="display:flex; justify-content:space-between; align-items:center; background:#222; padding:8px; margin-bottom:5px; border-radius:4px; font-size:12px;">
                    <span>vs ${m.enemy} (${m.ourScore}:${m.enemyScore})</span>
                    <button class="delete" style="padding:2px 8px; width:auto;" onclick="deleteHistoryMatch(${m.id})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');
        }
    });

    window.deleteHistoryMatch = async (matchId) => {
        if(!confirm("–£–¥–∞–ª–∏—Ç—å –º–∞—Ç—á?")) return;
        try {
            const docRef = doc(db, "siteData", "history");
            const snap = await getDoc(docRef);
            const newList = snap.data().list.filter(m => m.id !== matchId);
            await setDoc(docRef, { list: newList });
        } catch (e) { alert(e.message); }
    };
    // 1. –£—Å—Ç–∞–Ω–æ–≤–∏ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å –∑–¥–µ—Å—å
const SECRET_PASSWORD = 'ARX#2026'; 

// 2. –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏
window.checkPassword = () => {
    const enteredPass = document.getElementById('adminPass').value;
    const errorMsg = document.getElementById('loginError');
    
    if (enteredPass === SECRET_PASSWORD) {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–∫—Ç –≤—Ö–æ–¥–∞ –≤ —Å–µ—Å—Å–∏—é
        sessionStorage.setItem('admin_logged_in', 'true');
        document.getElementById('loginOverlay').style.display = 'none';
    } else {
        errorMsg.style.display = 'block';
        document.getElementById('adminPass').value = '';
    }
};

// 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    if (sessionStorage.getItem('admin_logged_in') === 'true') {
        document.getElementById('loginOverlay').style.display = 'none';
    }
});

  </script>
</body>
</html>
