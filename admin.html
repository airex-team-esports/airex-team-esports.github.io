<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>AX Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { background: #050505; color: #fff; font-family: 'Montserrat', sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
    h1, h2, h3 { font-family: 'Orbitron', sans-serif; color: #e91e63; margin-top: 0; }
    .panel { background: #111; padding: 20px; border: 1px solid #333; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
    label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 12px; margin: 5px 0; background: #222; border: 1px solid #444; color: #fff; border-radius: 6px; box-sizing: border-box; }
    button { background: #e91e63; color: white; border: none; padding: 12px 20px; cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; width: 100%; border-radius: 6px; margin-top: 10px; font-weight: bold; transition: 0.2s; }
    button:hover { background: #ff0060; transform: scale(1.02); }
    button.delete { background: #ff3333; width: auto; padding: 5px 12px; font-size: 10px; margin: 0; }
    .player-item { display: flex; justify-content: space-between; align-items: center; background: #1a1a1a; padding: 12px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #333; }
    .loader { text-align: center; color: #e91e63; font-family: 'Orbitron'; display: none; }
  </style>
</head>
<body>
  
  <div id="loginOverlay" style="position: fixed; inset: 0; background: #050505; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;">
    <div class="panel" style="max-width: 350px; width: 100%; text-align: center;">
        <h2 style="margin-bottom: 20px;">üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
        <input type="password" id="adminPass" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" style="text-align: center; margin-bottom: 15px;">
        <button onclick="checkPassword()">–í–û–ô–¢–ò</button>
        <p id="loginError" style="color: #ff3333; font-size: 12px; margin-top: 10px; display: none;">–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!</p>
    </div>
  </div>

  <h1>AIREX // ADMIN</h1>

  <div class="panel">
    <h2>‚ö° –°–ª–µ–¥—É—é—â–∏–π –º–∞—Ç—á</h2>
    <label>–ò–º—è —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</label>
    <input type="text" id="enemyName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: NAVI">
    
    <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è (–°—Ç–∞–≤—å—Ç–µ –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ!)</label>
    <input type="datetime-local" id="matchDate" step="60">
    
    <div id="matchCurrentStatus" style="font-size: 10px; color: #00ff88; margin-bottom: 5px; display:none;">
        –°–µ–π—á–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ: <span id="currentSavedTime"></span>
    </div>

    <button id="saveMatchBtn" onclick="saveMatch()">–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä</button>
</div>


  <div class="panel">
    <h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–æ–º</h2>
    
    <div style="margin-bottom: 15px;">
        <label>–ö–∞–∫–æ–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫–∞–∑–∞—Ç—å?</label>
        <select id="viewListType" onchange="loadRosterList()">
            <option value="roster">–û—Å–Ω–æ–≤–Ω–æ–π (Main)</option>
            <option value="reserve">–ó–∞–ø–∞—Å–Ω—ã–µ (Reserve)</option>
        </select>
    </div>

    <div id="loading" class="loader">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <div id="rosterList"></div> 

    <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
    
    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞</h3>
    
    <label>–ö—É–¥–∞ –¥–æ–±–∞–≤–∏—Ç—å?</label>
    <select id="rosterType">
        <option value="roster">–í –æ—Å–Ω–æ–≤—É (Main)</option>
        <option value="reserve">–í –∑–∞–ø–∞—Å (Reserve)</option>
    </select>

    <label>–û—Å–Ω–æ–≤–Ω–æ–µ</label>
    <input type="text" id="pNick" placeholder="–ù–∏–∫–Ω–µ–π–º">
    <input type="text" id="pRole" placeholder="–†–æ–ª—å (–Ω–∞–ø—Ä. Sniper)">
    <input type="text" id="pQuote" placeholder="–¶–∏—Ç–∞—Ç–∞">
    <input type="text" id="pImg" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ">
    
    <div style="display:flex; gap:10px;">
        <div style="flex:1"><label>K/D</label><input type="text" id="pKd" placeholder="1.45"></div>
        <div style="flex:1"><label>HS %</label><input type="text" id="pHs" placeholder="55%"></div>
        <div style="flex:1"><label>–†–∞–Ω–≥</label><input type="text" id="pRank" placeholder="Elite"></div>
    </div>
    
    <button onclick="addPlayer()">+ –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</button>
  </div>
  
  <div class="panel">
    <h2>üèÜ –ò—Å—Ç–æ—Ä–∏—è –º–∞—Ç—á–µ–π</h2>
    <div id="historyAdminList" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px; border: 1px solid #333; padding: 10px;"></div>
    
    <label>–°–æ–ø–µ—Ä–Ω–∏–∫</label>
    <input type="text" id="hEnemy" placeholder="–¢–ï–ì –°–æ–ø–µ—Ä–Ω–∏–∫–∞">
    <label>–¢—É—Ä–Ω–∏—Ä</label>
    <input type="text" id="hTour" placeholder="Winter Cup">
    
    <div style="display:flex; gap:10px;">
        <div style="flex:1"><label>–ù–∞—à —Å—á–µ—Ç</label><input type="number" id="hOur"></div>
        <div style="flex:1"><label>–ò—Ö —Å—á–µ—Ç</label><input type="number" id="hEnemyScore"></div>
    </div>
    
    <label>–°–∫—Ä–∏–Ω—à–æ—Ç (URL)</label>
    <input type="text" id="hScreenshot" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç">
    
    <button onclick="addMatchToHistory()">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å—Ç–æ—Ä–∏—é</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDVFYaxAtzEi5zF8yi_ORJQYL66wQa-gpE", 
      authDomain: "airexsite.firebaseapp.com",
      projectId: "airexsite",
      storageBucket: "airexsite.firebasestorage.app",
      messagingSenderId: "276640665598",
      appId: "1:276640665598:web:d7400bd5962995efb43aaf"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 1. –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–ê–¢–ß–ï–ú (–ó–ê–ì–†–£–ó–ö–ê + –°–û–•–†–ê–ù–ï–ù–ò–ï)
    
    // –ê) –°–ª—É—à–∞–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö, —á—Ç–æ–±—ã –∞–¥–º–∏–Ω–∫–∞ —Å–∞–º–∞ –∑–∞–ø–æ–ª–Ω—è–ª–∞ –ø–æ–ª—è –ø—Ä–∏ –≤—Ö–æ–¥–µ
    onSnapshot(doc(db, "siteData", "match"), (docSnap) => {
      if (docSnap.exists()) {
        const data = docSnap.data();
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞
        if(document.getElementById('enemyName')) {
            document.getElementById('enemyName').value = data.enemy || "";
        }

        // –ó–∞–ø–æ–ª–Ω—è–µ–º –ø–æ–ª–µ –¥–∞—Ç—ã
        if(document.getElementById('matchDate') && data.date) {
            document.getElementById('matchDate').value = data.date;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–º, —á—Ç–æ —Å–µ–π—á–∞—Å –≤ –±–∞–∑–µ
            const statusDiv = document.getElementById('matchCurrentStatus');
            const timeSpan = document.getElementById('currentSavedTime');
            if(statusDiv && timeSpan) {
                statusDiv.style.display = 'block';
                // –ö—Ä–∞—Å–∏–≤–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
                const dateObj = new Date(data.date);
                timeSpan.innerText = `${data.enemy} | ${data.date.replace('T', ' ')} (–ú–°–ö)`;
            }
        }
      }
    });

    // –ë) –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    window.saveMatch = async () => {
      const btn = document.getElementById('saveMatchBtn');
      const enemy = document.getElementById('enemyName').value;
      const date = document.getElementById('matchDate').value;

      if(!enemy || !date) return alert("‚ùå –ó–∞–ø–æ–ª–Ω–∏ –∏ –∏–º—è, –∏ –¥–∞—Ç—É!");

      btn.innerText = "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...";
      btn.disabled = true;

      try {
        // –ú—ã —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ—Å—Ç–æ —Å—Ç—Ä–æ–∫—É –¥–∞—Ç—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä "2026-01-07T18:00"
        // Index.html —Å–∞–º –¥–æ–±–∞–≤–∏—Ç –∫ –Ω–µ–π "+03:00", –∫–∞–∫ –º—ã –Ω–∞—Å—Ç—Ä–æ–∏–ª–∏ —Ä–∞–Ω–µ–µ
        await setDoc(doc(db, "siteData", "match"), { enemy, date });
        
        alert('‚úÖ –¢–∞–π–º–µ—Ä —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω!');
      } catch (e) { 
        alert("–û—à–∏–±–∫–∞: " + e.message); 
      } finally {
        btn.innerText = "–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä";
        btn.disabled = false;
      }
    };


    // 2. –ü–†–û–°–ú–û–¢–† –ò–ì–†–û–ö–û–í (–î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ô)
    let unsubscribeRoster = null; // –•—Ä–∞–Ω–∏–º –ø–æ–¥–ø–∏—Å–∫—É, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è

    window.loadRosterList = () => {
        const type = document.getElementById('viewListType').value; // 'roster' –∏–ª–∏ 'reserve'
        const rosterDiv = document.getElementById('rosterList');
        
        // –û—Ç–ø–∏—Å—ã–≤–∞–µ–º—Å—è –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ —Å–ª—É—à–∞—Ç–µ–ª—è, –µ—Å–ª–∏ –±—ã–ª
        if(unsubscribeRoster) unsubscribeRoster();

        rosterDiv.innerHTML = '<div style="text-align:center; color:#888;">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';

        // –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–æ–ª–ª–µ–∫—Ü–∏—é
        unsubscribeRoster = onSnapshot(doc(db, "siteData", type), (docSnap) => {
            rosterDiv.innerHTML = '';
            if (docSnap.exists() && docSnap.data().list && docSnap.data().list.length > 0) {
                docSnap.data().list.forEach(p => {
                    const el = document.createElement('div');
                    el.className = 'player-item';
                    el.innerHTML = `
                        <div>
                            <b style="color:#e91e63">${p.nick}</b> 
                            <span style="font-size:10px; color:#888;">(${p.role})</span>
                        </div>
                        <button class="delete" onclick="removePlayer('${p.nick}', '${type}')">X</button>`;
                    rosterDiv.appendChild(el);
                });
            } else {
                rosterDiv.innerHTML = '<div style="text-align:center; padding:10px; color:#666;">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>';
            }
        });
    };

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadRosterList();

    // 3. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ö–ê (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê)
    window.addPlayer = async () => {
        const type = document.getElementById('rosterType').value; 
        
        const nick = document.getElementById('pNick').value;
        const role = document.getElementById('pRole').value;
        const quote = document.getElementById('pQuote').value;
        const img = document.getElementById('pImg').value;
        
        // –î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        const kd = document.getElementById('pKd').value;
        const hs = document.getElementById('pHs').value;
        const rank = document.getElementById('pRank').value;

        if(!nick || !img) return alert("–ù–∏–∫ –∏ —Ñ–æ—Ç–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!");

        // –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç (–ë–ï–ó –í–õ–û–ñ–ï–ù–ù–û–°–¢–ò stats, —á—Ç–æ–±—ã –ø—Ä–æ—â–µ —á–∏—Ç–∞—Ç—å –Ω–∞ —Å–∞–π—Ç–µ)
        const newPlayer = {
            nick: nick,
            role: role || "Player",
            quote: quote || "...",
            img: img,
            // –ü–∏—à–µ–º –Ω–∞–ø—Ä—è–º—É—é, –±–µ–∑ –ª–∏—à–Ω–∏—Ö —Å–∫–æ–±–æ–∫ stats: {}
            kd: kd || "0.00",
            hs: hs || "0%",
            rank: rank || "Unknown" 
        };

        try {
            const docRef = doc(db, "siteData", type);
            const snap = await getDoc(docRef);
            let list = (snap.exists() && snap.data().list) ? snap.data().list : [];
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç
            if(list.some(p => p.nick === newPlayer.nick)) {
                return alert("–ò–≥—Ä–æ–∫ —Å —Ç–∞–∫–∏–º –Ω–∏–∫–æ–º —É–∂–µ –µ—Å—Ç—å!");
            }

            list.push(newPlayer);
            await setDoc(docRef, { list });
            alert(`‚úÖ ${nick} –¥–æ–±–∞–≤–ª–µ–Ω –≤ ${type === 'roster' ? '–û—Å–Ω–æ–≤—É' : '–ó–∞–ø–∞—Å'}!`);
            
            // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π
            document.getElementById('pNick').value = '';
            document.getElementById('pRole').value = '';
            document.getElementById('pQuote').value = '';
            document.getElementById('pImg').value = '';
            document.getElementById('pKd').value = '';
            document.getElementById('pHs').value = '';
            document.getElementById('pRank').value = '';
            
        } catch (e) { 
            console.error(e);
            alert("–û—à–∏–±–∫–∞: " + e.message); 
        }
    };
 

    // 4. –£–î–ê–õ–ï–ù–ò–ï –ò–ì–†–û–ö–ê
    window.removePlayer = async (nickToDelete, type) => {
        if(!confirm(`–£–¥–∞–ª–∏—Ç—å ${nickToDelete} –∏–∑ —Å–ø–∏—Å–∫–∞ ${type}?`)) return;
        try {
            const docRef = doc(db, "siteData", type);
            const snap = await getDoc(docRef);
            if (snap.exists()) {
                const newList = snap.data().list.filter(p => p.nick !== nickToDelete);
                await setDoc(docRef, { list: newList });
            }
        } catch (e) { alert(e.message); }
    };
  
    // 5. –î–û–ë–ê–í–õ–ï–ù–ò–ï –í –ò–°–¢–û–†–ò–Æ
    window.addMatchToHistory = async () => {
        const enemy = document.getElementById('hEnemy').value;
        const tour = document.getElementById('hTour').value;
        const ourS = document.getElementById('hOur').value;
        const enemyS = document.getElementById('hEnemyScore').value;
        const screen = document.getElementById('hScreenshot').value;

        if(!enemy || ourS === "" || enemyS === "") return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è –∏—Å—Ç–æ—Ä–∏–∏!");

        const newMatch = {
            id: Date.now(),
            enemy, 
            tournament: tour || "Match",
            ourScore: parseInt(ourS),
            enemyScore: parseInt(enemyS),
            screenshot: screen || null
        };

        try {
            const docRef = doc(db, "siteData", "history");
            const snap = await getDoc(docRef);
            let list = (snap.exists() && snap.data().list) ? snap.data().list : [];
            list.push(newMatch);
            await setDoc(docRef, { list });
            alert("‚úÖ –ú–∞—Ç—á –¥–æ–±–∞–≤–ª–µ–Ω!");
            document.getElementById('hEnemy').value = '';
            document.getElementById('hScreenshot').value = '';
        } catch (e) { alert(e.message); }
    };

    // 6. –°–ü–ò–°–û–ö –ò–°–¢–û–†–ò–ò (–°–õ–£–®–ê–¢–ï–õ–¨)
    onSnapshot(doc(db, "siteData", "history"), (docSnap) => {
        const container = document.getElementById('historyAdminList');
        if (docSnap.exists() && container) {
            const matches = docSnap.data().list || [];
            container.innerHTML = matches.slice().reverse().map(m => `
                <div style="display:flex; justify-content:space-between; align-items:center; background:#222; padding:8px; margin-bottom:5px; border-radius:4px; font-size:12px;">
                    <span>vs ${m.enemy} (${m.ourScore}:${m.enemyScore})</span>
                    <button class="delete" style="padding:2px 8px; width:auto;" onclick="deleteHistoryMatch(${m.id})">–£–¥–∞–ª–∏—Ç—å</button>
                </div>
            `).join('');
        }
    });

    window.deleteHistoryMatch = async (matchId) => {
        if(!confirm("–£–¥–∞–ª–∏—Ç—å –º–∞—Ç—á?")) return;
        try {
            const docRef = doc(db, "siteData", "history");
            const snap = await getDoc(docRef);
            const newList = snap.data().list.filter(m => m.id !== matchId);
            await setDoc(docRef, { list: newList });
        } catch (e) { alert(e.message); }
    };

    // –õ–û–ì–ò–ù
    const SECRET_PASSWORD = 'ARX#2026'; 

    window.checkPassword = () => {
        const enteredPass = document.getElementById('adminPass').value;
        const errorMsg = document.getElementById('loginError');
        
        if (enteredPass === SECRET_PASSWORD) {
            sessionStorage.setItem('admin_logged_in', 'true');
            document.getElementById('loginOverlay').style.display = 'none';
        } else {
            errorMsg.style.display = 'block';
            document.getElementById('adminPass').value = '';
        }
    };

    document.addEventListener('DOMContentLoaded', () => {
        if (sessionStorage.getItem('admin_logged_in') === 'true') {
            document.getElementById('loginOverlay').style.display = 'none';
        }
    });

  </script>
</body>
</html>

