<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>AX Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { background: #050505; color: #fff; font-family: 'Montserrat', sans-serif; padding: 20px; max-width: 600px; margin: 0 auto; }
    h1, h2, h3 { font-family: 'Orbitron', sans-serif; color: #e91e63; margin-top: 0; }
    
    .panel { 
        background: #111; 
        padding: 20px; 
        border: 1px solid #333; 
        margin-bottom: 20px; 
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    
    label { font-size: 12px; color: #888; text-transform: uppercase; letter-spacing: 1px; display: block; margin-top: 10px; }
    input { 
        width: 100%; padding: 12px; margin: 5px 0; 
        background: #222; border: 1px solid #444; color: #fff; border-radius: 6px; box-sizing: border-box; 
    }
    input:focus { border-color: #e91e63; outline: none; }
    
    button { 
        background: #e91e63; color: white; border: none; padding: 12px 20px; 
        cursor: pointer; font-family: 'Orbitron'; text-transform: uppercase; 
        width: 100%; border-radius: 6px; margin-top: 10px; font-weight: bold; transition: 0.2s;
    }
    button:hover { background: #ff0060; transform: scale(1.02); }
    button.delete { background: #ff3333; width: auto; padding: 5px 12px; font-size: 10px; margin: 0; }

    .player-item { 
        display: flex; justify-content: space-between; align-items: center;
        background: #1a1a1a; padding: 12px; margin-bottom: 8px; border-radius: 6px; border: 1px solid #333; 
    }
    .player-info b { color: #fff; font-size: 16px; }
    .player-info span { color: #888; font-size: 12px; margin-left: 5px; }
    
    .loader { text-align: center; color: #e91e63; font-family: 'Orbitron'; display: none; }
  </style>
</head>
<body>

  <h1>AIREX // ADMIN</h1>

  <div class="panel">
    <h2>‚ö° –°–ª–µ–¥—É—é—â–∏–π –º–∞—Ç—á</h2>
    <label>–ò–º—è —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</label>
    <input type="text" id="enemyName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: NAVI">
    <label>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</label>
    <input type="datetime-local" id="matchDate">
    <button onclick="saveMatch()">–û–±–Ω–æ–≤–∏—Ç—å —Ç–∞–π–º–µ—Ä</button>
  </div>

  <div class="panel">
    <h2>üë• –°–æ—Å—Ç–∞–≤ –∫–æ–º–∞–Ω–¥—ã</h2>
    
    <div id="loading" class="loader">–ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞...</div>
    <div id="rosterList"></div> 

    <hr style="border: 0; border-top: 1px solid #333; margin: 20px 0;">
    
    <h3>–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</h3>
    <input type="text" id="pNick" placeholder="–ù–∏–∫–Ω–µ–π–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: Sn1per)">
    <input type="text" id="pRole" placeholder="–†–æ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä: Captain)">
    <input type="text" id="pQuote" placeholder="–¶–∏—Ç–∞—Ç–∞">
    <input type="text" id="pImg" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ (URL)">
    
    <div style="display:flex; gap:10px;">
        <div style="flex:1">
            <label>–°–∫–∏–ª–ª (–ù–∞–∑–≤–∞–Ω–∏–µ)</label>
            <input type="text" id="s1Name" placeholder="AIM">
        </div>
        <div style="flex:1">
            <label>–ü—Ä–æ—Ü–µ–Ω—Ç %</label>
            <input type="number" id="s1Val" placeholder="98">
        </div>
    </div>
    
    <button onclick="addPlayer()">+ –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–æ—Å—Ç–∞–≤</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, onSnapshot } 
    from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

    // –¢–í–û–ô –ö–û–ù–§–ò–ì (–Ø –í–ó–Ø–õ –ï–ì–û –ò–ó –¢–í–û–ï–ì–û –§–ê–ô–õ–ê)
    const firebaseConfig = {
      apiKey: "AIzaSyDVFYaxAtzEi5zF8yi_ORJQYL66wQa-gpE", 
      authDomain: "airexsite.firebaseapp.com",
      projectId: "airexsite",
      storageBucket: "airexsite.firebasestorage.app",
      messagingSenderId: "276640665598",
      appId: "1:276640665598:web:d7400bd5962995efb43aaf"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 1. –°–û–•–†–ê–ù–ï–ù–ò–ï –ú–ê–¢–ß–ê
    window.saveMatch = async () => {
      const enemy = document.getElementById('enemyName').value;
      const date = document.getElementById('matchDate').value;
      
      if(!enemy || !date) { alert("–ó–∞–ø–æ–ª–Ω–∏ –æ–±–∞ –ø–æ–ª—è –¥–ª—è –º–∞—Ç—á–∞!"); return; }

      try {
        await setDoc(doc(db, "siteData", "match"), { enemy, date });
        alert('‚úÖ –ú–∞—Ç—á –æ–±–Ω–æ–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
      } catch (e) { alert('–û—à–∏–±–∫–∞: ' + e.message); }
    };

    // 2. –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –°–ü–ò–°–ö–ê (–°–õ–£–®–ê–¢–ï–õ–¨)
    const rosterDiv = document.getElementById('rosterList');
    const loadDiv = document.getElementById('loading');
    
    loadDiv.style.display = 'block';

    onSnapshot(doc(db, "siteData", "roster"), (docSnap) => {
        loadDiv.style.display = 'none';
        rosterDiv.innerHTML = '';
        
        if (docSnap.exists() && docSnap.data().list) {
            const players = docSnap.data().list;
            
            if(players.length === 0) {
                rosterDiv.innerHTML = '<div style="text-align:center; color:#555">–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</div>';
                return;
            }

            players.forEach(p => {
                const el = document.createElement('div');
                el.className = 'player-item';
                el.innerHTML = `
                    <div class="player-info">
                        <b>${p.nick}</b> <span>${p.role}</span>
                    </div>
                    <button class="delete" onclick="removePlayer('${p.nick}')">–£–î–ê–õ–ò–¢–¨</button>
                `;
                rosterDiv.appendChild(el);
            });
        } else {
            rosterDiv.innerHTML = '<div style="text-align:center; color:#555">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–∞ –ø–æ–∫–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å –ø–µ—Ä–≤–æ–≥–æ –∏–≥—Ä–æ–∫–∞!</div>';
        }
    });

    // 3. –î–û–ë–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ö–ê (–ü–ï–†–ï–ü–ò–°–ê–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê)
    window.addPlayer = async () => {
        const nick = document.getElementById('pNick').value;
        const role = document.getElementById('pRole').value;
        
        if(!nick || !role) { alert("–£–∫–∞–∂–∏ —Ö–æ—Ç—è –±—ã –ù–∏–∫ –∏ –†–æ–ª—å!"); return; }

        const newPlayer = {
            nick: nick,
            role: role,
            quote: document.getElementById('pQuote').value || "No quote",
            img: document.getElementById('pImg').value || "https://via.placeholder.com/200/e91e63/ffffff?text=Player",
            skill: { 
                name: document.getElementById('s1Name').value || "SKILL", 
                val: document.getElementById('s1Val').value || 50 
            }
        };

        try {
            const docRef = doc(db, "siteData", "roster");
            const snap = await getDoc(docRef);
            let currentList = [];
            
            if (snap.exists() && snap.data().list) {
                currentList = snap.data().list;
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–≥–æ –≤ –º–∞—Å—Å–∏–≤
            currentList.push(newPlayer);
            
            // –ü–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤–µ—Å—å —Å–ø–∏—Å–æ–∫
            await setDoc(docRef, { list: currentList });
            
            // –û—á–∏—â–∞–µ–º –ø–æ–ª—è
            document.getElementById('pNick').value = '';
            document.getElementById('pRole').value = '';
            document.getElementById('pQuote').value = '';
            alert(`‚úÖ –ò–≥—Ä–æ–∫ ${nick} –¥–æ–±–∞–≤–ª–µ–Ω!`);
            
        } catch (e) {
            console.error(e);
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏: ' + e.message);
        }
    };

    // 4. –£–î–ê–õ–ï–ù–ò–ï –ò–ì–†–û–ö–ê
    window.removePlayer = async (nickToDelete) => {
        if(!confirm(`–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å ${nickToDelete}?`)) return;

        try {
            const docRef = doc(db, "siteData", "roster");
            const snap = await getDoc(docRef);
            
            if (snap.exists()) {
                let list = snap.data().list;
                // –§–∏–ª—å—Ç—Ä—É–µ–º —Å–ø–∏—Å–æ–∫: –æ—Å—Ç–∞–≤–ª—è–µ–º –≤—Å–µ—Ö, –ö–†–û–ú–ï —Ç–æ–≥–æ, —á–µ–π –Ω–∏–∫ —É–¥–∞–ª—è–µ–º
                const newList = list.filter(p => p.nick !== nickToDelete);
                
                await setDoc(docRef, { list: newList });
            }
        } catch (e) {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + e.message);
        }
    };
  </script>
</body>
</html>
