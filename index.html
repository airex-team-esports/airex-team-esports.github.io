<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#ff004c"> <meta name="description" content="Официальный сайт киберспортивной организации AIREX TEAM. Доминируй. Развивайся. Побеждай.">
<meta name="keywords" content="Airex Team, Standoff 2, Cybersport, Clan, Tournaments">

<title>AIREX TEAM | Официальный сайт</title>
  
<meta property="og:title" content="AIREX TEAM | Esports Organization">
<meta property="og:description" content="Официальный портал команды AIREX. Новости, состав и запись на праки.">
<meta property="og:image" content="https://airex-team-esports.github.io/logo.png"> 
<meta property="og:type" content="website">
<meta property="og:url" content="https://airex-team-esports.github.io/">

  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* --- 1. CORE VARIABLES (SYSTEM CONFIG) --- */
    :root {
      --accent: #ff004c;
      --accent-dim: rgba(255, 0, 76, 0.1);
      --accent-glow: rgba(255, 0, 76, 0.5);
      
      --bg-deep: #050505;
      --bg-panel: rgba(15, 15, 15, 0.85);
      
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-highlight: rgba(255, 255, 255, 0.03);
      
      --text-white: #ffffff;
      --text-gray: #a0a0a0;
      --text-muted: #555555;
      
      --success: #00ffa3;
      --warning: #ffcc00;
      
      --font-main: 'Montserrat', sans-serif;
      --font-tech: 'Orbitron', sans-serif;
      
      --ease-smooth: cubic-bezier(0.23, 1, 0.32, 1);
      --ease-bounce: cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* --- 2. GLOBAL RESET & SCROLLBAR --- */
    html { scroll-behavior: smooth; }
    *, *::before, *::after { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    body {
      margin: 0; 
      background-color: var(--bg-deep);
      font-family: var(--font-main); 
      color: var(--text-white);
      min-height: 100vh; 
      overflow-x: hidden; 
      padding-top: 80px;
      user-select: none;
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg-deep); }
    ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #ff3366; }

    /* --- 3. ATMOSPHERE & BACKGROUND --- */
    .scanlines {
      position: fixed; inset: 0; pointer-events: none; z-index: 9000;
      background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
      background-size: 100% 3px, 3px 100%;
      opacity: 0.6;
    }

    .bg-logo {
      opacity: 0.04;
      position: fixed; top: 50%; left: 50%; 
      transform: translate(-50%, -50%);
      width: 90vw; height: 90vh;
      background: url('logo.png') center/contain no-repeat;
      z-index: -1; pointer-events: none;
      filter: grayscale(100%);
    }

    /* --- 4. PRELOADER --- */
    #preloader {
      position: fixed; inset: 0; z-index: 11000;
      background: var(--bg-deep);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: opacity 0.5s ease, visibility 0.5s;
    }
    .loader-spinner {
      width: 50px; height: 50px; border: 3px solid transparent;
      border-top-color: var(--accent); border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    /* --- 5. UI COMPONENTS (Buttons, Cards) --- */
    .btn-glitch {
      display: inline-flex; align-items: center; justify-content: center;
      padding: 14px 28px; background: rgba(0,0,0,0.6);
      border: 1px solid var(--accent); color: #fff;
      font-family: var(--font-tech); text-transform: uppercase; 
      font-size: 12px; font-weight: 700; letter-spacing: 2px;
      cursor: pointer; width: 100%; border-radius: 4px;
      transition: all 0.3s ease; position: relative; overflow: hidden;
      box-shadow: 0 0 10px rgba(255, 0, 76, 0.1);
    }
    .btn-glitch::before {
      content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.5s;
    }
    .btn-glitch:hover { 
      background: var(--accent); 
      box-shadow: 0 0 25px var(--accent-glow); 
      transform: translateY(-2px); 
    }
    .btn-glitch:hover::before { left: 100%; }
    
    .btn-secondary { 
      background: rgba(255,255,255,0.03); 
      border-color: var(--glass-border); 
      color: var(--text-gray); 
    }
    .btn-secondary:hover { background: rgba(255,255,255,0.1); border-color: #fff; box-shadow: none; }

    .card {
      background: var(--bg-panel);
      backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 16px; padding: 24px; margin-bottom: 20px;
      position: relative; overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      transition: transform 0.3s ease, border-color 0.3s ease;
    }
    .card:hover { border-color: var(--accent-dim); }

    /* --- 6. NAVIGATION --- */
    .navbar {
      position: fixed; top: 0; inset-inline: 0; height: 72px;
      background: rgba(5, 5, 5, 0.9); 
      backdrop-filter: blur(20px); 
      border-bottom: 1px solid var(--glass-border); 
      z-index: 1000;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 5%;
    }
    .nav-brand { display: flex; align-items: center; gap: 12px; cursor: pointer; }
    .nav-brand img { height: 40px; filter: drop-shadow(0 0 8px var(--accent-dim)); }
    .nav-brand h1 {
      font-family: var(--font-tech); font-size: 18px; margin: 0;
      text-transform: uppercase; letter-spacing: 2px;
      background: linear-gradient(135deg, #fff 50%, #777);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    
    .menu-toggle {
      background: transparent; border: none; color: #fff;
      font-size: 24px; cursor: pointer; padding: 10px;
      transition: transform 0.3s ease, color 0.3s ease;
    }
    .menu-toggle.active { transform: rotate(90deg); color: var(--accent); }

    .nav-dropdown {
      position: fixed; top: 75px; right: 20px; width: 220px;
      background: rgba(15, 15, 15, 0.98);
      border: 1px solid var(--glass-border); border-radius: 12px; padding: 8px;
      display: flex; flex-direction: column; gap: 4px;
      opacity: 0; visibility: hidden;
      transform: translateY(-10px) scale(0.95);
      transition: all 0.3s var(--ease-bounce);
      box-shadow: 0 20px 50px rgba(0,0,0,0.9);
      z-index: 1001;
    }
    .nav-dropdown.active { opacity: 1; visibility: visible; transform: translateY(0) scale(1); }

    .menu-item {
      display: flex; align-items: center; gap: 15px; padding: 12px 16px;
      background: transparent; border: none;
      color: var(--text-gray); font-family: var(--font-tech);
      font-size: 11px; text-transform: uppercase; font-weight: 600;
      letter-spacing: 1px; border-radius: 6px;
      cursor: pointer; transition: 0.2s; width: 100%; text-align: left;
    }
    .menu-item:hover, .menu-item.active-tab { background: var(--accent-dim); color: #fff; }
    .menu-item.active-tab i { color: var(--accent); }
    
    /* Badge System */
    .has-update::after {
      content: ''; position: absolute; right: 12px; width: 6px; height: 6px;
      background: var(--success); border-radius: 50%;
      box-shadow: 0 0 8px var(--success); animation: pulse-dot 2s infinite;
    }
    @keyframes pulse-dot { 50% { opacity: 0.4; transform: scale(1.2); } }

    /* --- 7. SECTIONS & ANIMATIONS --- */
    .container { max-width: 900px; margin: 0 auto; padding: 20px 15px 100px 15px; }
    
    section { 
      display: none; opacity: 0; 
      transform: translateY(20px); 
      transition: opacity 0.4s ease, transform 0.4s ease; 
    }
    section.active { display: block; opacity: 1; transform: translateY(0); }

    .font-tech { font-family: var(--font-tech); }
    .text-center { text-align: center; }
    .text-accent { color: var(--accent); }

    /* Hero */
    .hero-title {
      font-family: var(--font-tech); font-size: 36px; font-weight: 900;
      letter-spacing: 4px; color: #fff; margin-bottom: 10px;
      text-shadow: 0 0 20px var(--accent-dim);
    }
    #typing-text { font-family: monospace; color: var(--success); min-height: 20px; font-size: 13px; margin-bottom: 25px; }

    /* Inputs */
    .form-group { margin-bottom: 15px; }
    .form-label { display: block; color: var(--accent); font-size: 10px; margin-bottom: 6px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
    .form-input {
      width: 100%; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--glass-border);
      color: #fff; padding: 14px; border-radius: 8px; outline: none; transition: 0.3s;
      font-family: var(--font-main); font-size: 14px;
    }
    .form-input:focus { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-dim); background: rgba(0,0,0,0.5); }

    /* Match Center */
    .match-card {
      background: linear-gradient(180deg, rgba(20,20,20,0.95) 0%, rgba(30,10,15,0.6) 100%);
      border: 1px solid rgba(255, 0, 76, 0.2);
    }
    .countdown { display: flex; justify-content: center; gap: 15px; margin: 20px 0; font-family: var(--font-tech); }
    .cd-num { font-size: 32px; font-weight: 700; line-height: 1; }
    .cd-lbl { font-size: 9px; color: var(--accent); margin-top: 5px; text-align: center; }

/* === НОВЫЙ ДИЗАЙН СОСТАВА (EVO CARDS) === */
/* === УЛУЧШЕННЫЙ ДИЗАЙН КАРТОЧЕК (EVO) === */
.roster-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 20px;
}

.evo-card {
    position: relative;
    height: 420px;
    background: #0a0a0a;
    border: 1px solid #222;
    border-radius: 4px;
    overflow: hidden;
    transition: 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    clip-path: polygon(0 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%);
}

.evo-card:hover {
    transform: translateY(-5px);
    border-color: var(--accent);
    box-shadow: 0 10px 30px rgba(255, 0, 76, 0.2);
}

.evo-avatar {
    width: 100%; height: 100%; object-fit: cover;
    opacity: 0.5; filter: grayscale(100%); transition: 0.5s;
}

.evo-card:hover .evo-avatar {
    opacity: 0.9; filter: grayscale(0%); transform: scale(1.05);
}

.evo-overlay {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 80%;
    background: linear-gradient(to top, #000 15%, rgba(0,0,0,0.7) 50%, transparent);
    pointer-events: none;
}

.evo-info {
    position: absolute; bottom: 25px; left: 20px; right: 20px;
    z-index: 2; transition: 0.4s;
}

.evo-card:hover .evo-info { bottom: 165px; } /* Поднимаем выше, так как стат-панель стала больше */

.evo-role {
    font-size: 9px; font-weight: 800; color: var(--accent);
    letter-spacing: 2px; text-transform: uppercase;
    padding: 3px 8px; border: 1px solid var(--accent);
    background: rgba(255, 0, 76, 0.1); margin-bottom: 8px; display: inline-block;
}

.evo-nick {
    font-family: var(--font-tech); font-size: 28px;
    color: #fff; text-transform: uppercase; margin: 0;
}

.evo-quote {
    font-size: 11px; color: #888; margin-top: 6px; font-style: italic;
    border-left: 2px solid var(--accent); padding-left: 8px;
}

/* ОБНОВЛЕННАЯ ПАНЕЛЬ СТАТИСТИКИ (БОЛЬШЕ ДАННЫХ) */
.evo-stats-panel {
    position: absolute; bottom: -160px; left: 0; width: 100%;
    height: 155px; background: rgba(10, 10, 10, 0.98);
    border-top: 1px solid var(--accent); backdrop-filter: blur(15px);
    display: flex; flex-direction: column; justify-content: center;
    padding: 15px; transition: 0.4s var(--ease-smooth); z-index: 3;
}

.evo-card:hover .evo-stats-panel { bottom: 0; }

.stats-grid {
    display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
    margin-bottom: 12px; border-bottom: 1px solid #222; padding-bottom: 10px;
}

.extra-info {
    display: flex; justify-content: space-between; font-size: 10px; color: #666;
}

.stat-box { text-align: center; }
.stat-val { font-family: var(--font-tech); font-size: 16px; color: #fff; }
.stat-lbl { font-size: 8px; color: #555; text-transform: uppercase; margin-top: 2px; }

    /* News */
    .news-card-home { 
      padding: 15px; border-radius: 12px; 
      background: rgba(255,255,255,0.02); border: 1px solid var(--glass-border); 
      margin-bottom: 12px; transition: 0.3s; 
    }
    .news-card-home:hover { background: rgba(255,255,255,0.04); transform: translateX(5px); border-left: 2px solid var(--accent); }

    /* Player & HUD */
    #ambient-player {
        position: fixed; bottom: 25px; left: 25px; z-index: 9999;
        display: flex; align-items: center; gap: 12px;
        background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(10px);
        padding: 8px 16px; border-radius: 50px;
        border: 1px solid var(--glass-border);
        transition: 0.3s;
    }
    #ambient-player:hover { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-dim); }
    
    .hud-toast {
      background: rgba(10, 10, 10, 0.95);
      border-left: 3px solid var(--accent);
      padding: 15px 20px; min-width: 280px;
      color: #fff; font-family: var(--font-tech);
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
      backdrop-filter: blur(10px);
      display: flex; align-items: center; gap: 15px;
      /* Animation classes handled in JS */
      transform: translateX(120%); opacity: 0;
      transition: all 0.4s var(--ease-bounce);
    }
    .hud-toast.active { transform: translateX(0); opacity: 1; }
/* Сетка для статистики (Win Rate) */
.stats-row { 
    display: grid; 
    grid-template-columns: 1fr 1fr; /* Две колонки */
    gap: 15px; 
    margin-bottom: 25px; 
}

/* Карточка статистики */
.stat-card {
    background: rgba(255,255,255,0.02); 
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 12px; 
    padding: 20px; 
    text-align: center;
    position: relative; 
    overflow: hidden;
}

/* Большие цифры */
.stat-val-big {
    font-family: var(--font-tech); /* Шрифт Orbitron */
    font-size: 32px; 
    font-weight: 700; 
    color: #fff;
    text-shadow: 0 0 15px rgba(255,255,255,0.2);
}

/* Подписи под цифрами */
.stat-label { 
    font-size: 9px; 
    text-transform: uppercase; 
    color: #666; 
    margin-top: 5px; 
    letter-spacing: 1px; 
    font-weight: 700;
}
/* --- SCHEDULE SECTION STYLES --- */
.schedule-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Адаптивная сетка */
    gap: 20px;
    margin-top: 20px;
}

.day-card {
    background: rgba(20, 20, 20, 0.6);
    border: 1px solid var(--glass-border);
    border-radius: 8px;
    overflow: hidden;
    transition: 0.3s;
    position: relative;
}

/* Подсветка текущего дня (будет работать через JS или просто стиль) */
.day-card.today {
    border-color: var(--accent);
    box-shadow: 0 0 15px var(--accent-dim);
}

.day-header {
    background: rgba(255, 255, 255, 0.03);
    padding: 10px 15px;
    border-bottom: 1px solid var(--glass-border);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.day-title {
    font-family: var(--font-tech);
    color: #fff;
    font-size: 14px;
    text-transform: uppercase;
}

.day-date {
    font-size: 10px;
    color: var(--text-gray);
    font-weight: 600;
}

.events-list {
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.event-item {
    display: flex;
    align-items: center;
    background: rgba(0, 0, 0, 0.4);
    border-radius: 4px;
    padding: 8px 10px;
    border-left: 2px solid #333; /* Дефолтный цвет */
    transition: 0.2s;
}

.event-item:hover {
    background: rgba(255, 255, 255, 0.05);
    transform: translateX(3px);
}

/* Цвета для разных типов событий */
.type-pracc { border-left-color: var(--accent); } /* Красный */
.type-tour { border-left-color: var(--warning); } /* Желтый */
.type-train { border-left-color: #00ccff; } /* Голубой */
.type-rest { border-left-color: #555; opacity: 0.5; } /* Серый */

.event-time {
    font-family: var(--font-tech);
    font-size: 12px;
    color: #fff;
    width: 50px;
    flex-shrink: 0;
}

.event-info {
    display: flex;
    flex-direction: column;
}

.event-name {
    font-size: 11px;
    color: #eee;
    font-weight: 700;
}

.event-desc {
    font-size: 9px;
    color: #888;
}

.tag-badge {
    margin-left: auto;
    font-size: 8px;
    padding: 2px 5px;
    border-radius: 3px;
    font-family: var(--font-tech);
    text-transform: uppercase;
}

/* Цвета бейджиков */
.bg-pracc { background: rgba(255, 0, 76, 0.2); color: var(--accent); }
.bg-tour { background: rgba(255, 204, 0, 0.2); color: var(--warning); }
.bg-train { background: rgba(0, 204, 255, 0.2); color: #00ccff; }

  </style>
</head>
<body>

<div class="scanlines"></div>
<div class="bg-logo"></div>

<div id="preloader">
    <div class="loader-spinner"></div>
    <div style="margin-top: 15px; font-family: var(--font-tech); letter-spacing: 2px; font-size: 12px; color: var(--text-gray);">SYSTEM LOADING</div>
</div>

<div id="ambient-player">
    <div class="play-state-icon" id="music-btn" onclick="toggleAmbient()" style="cursor: pointer; color: var(--accent);">
        <i class="fas fa-play" id="btn-icon"></i>
    </div>
    <div style="display: flex; flex-direction: column;">
        <span style="font-size: 9px; color: #666; font-family: var(--font-tech);">AMBIENT MODE</span>
        <span id="player-status" style="font-size: 11px; font-weight: 600;">OFFLINE</span>
    </div>
    <audio id="bg-music" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>
</div>

<nav class="navbar">
    <div class="nav-brand" onclick="location.reload()">
      <img src="logo.png" alt="AX" onerror="this.style.display='none'"> 
      <h1>Airex<span style="color:var(--text-gray); font-weight:400;">Team</span></h1>
    </div>

    <button class="menu-toggle" id="menuBtn" onclick="toggleMenu()">
        <i class="fas fa-bars"></i>
    </button>

    <div class="nav-dropdown" id="navDropdown">
      <button class="menu-item active-tab" id="btn-home" onclick="selectTab('home', this)"><i class="fas fa-home"></i> Главная</button>
      <button class="menu-item" id="btn-team" onclick="selectTab('team', this)"><i class="fas fa-users"></i> Состав</button>
      <button class="menu-item" id="btn-practice" onclick="selectTab('practice', this)"><i class="fas fa-crosshairs"></i> Праки</button>
      <button class="menu-item" id="btn-about" onclick="selectTab('about', this)"><i class="fas fa-shield-alt"></i> Инфо</button>
      <button class="menu-item" id="btn-news" onclick="selectTab('news', this)"><i class="fas fa-bolt"></i> Новости</button>
      <button class="menu-item" id="btn-media" onclick="selectTab('media', this)"><i class="fas fa-play-circle"></i> Медиа</button>
      <button class="menu-item" id="btn-history" onclick="selectTab('history', this)"><i class="fas fa-trophy"></i> Матчи</button>
      <button class="menu-item" id="btn-reviews" onclick="selectTab('reviews', this)"><i class="fas fa-star"></i> Отзывы</button>
      <div style="height: 1px; background: rgba(255,255,255,0.1); margin: 5px 0;"></div>
      <button class="menu-item" id="btn-schedule" onclick="selectTab('schedule', this)">
    <i class="far fa-calendar-alt"></i> Расписание
</button>

      <button class="menu-item" style="color: var(--accent);" onclick="selectTab('join', this)"><i class="fas fa-user-plus"></i> Вступить</button>
    </div>
</nav>

<div class="container">

    <section id="home" class="active">
      <div class="card text-center" style="padding: 50px 20px; border-top: 1px solid var(--accent);">
        <h2 class="hero-title" data-text="AIREX TEAM">AIREX TEAM</h2>
        <div id="typing-text"></div>
        <button class="btn-glitch" onclick="selectTab('join', null)" style="max-width: 250px;">
             ПОДАТЬ ЗАЯВКУ <i class="fas fa-angle-right" style="margin-left: 10px;"></i>
        </button>
      </div>

      <div class="stats-row">
    <div class="stat-card">
        <div class="stat-val-big" id="win-rate-display">0%</div>
        <div class="stat-label">WIN RATE (СЕЗОН)</div>
        <i class="fas fa-chart-line" style="position: absolute; top: 10px; right: 10px; color: var(--accent); opacity: 0.2;"></i>
    </div>

    <div class="stat-card">
        <div class="stat-val-big" id="total-games-display">0</div>
        <div class="stat-label">СЫГРАНО МАТЧЕЙ</div>
        <i class="fas fa-trophy" style="position: absolute; top: 10px; right: 10px; color: #00ffa3; opacity: 0.2;"></i>
    </div>
</div>

      
      <div class="card match-card">
        <div style="display: flex; justify-content: space-between; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 10px; margin-bottom: 15px;">
            <span class="font-tech text-accent" style="font-size: 11px;"><i class="fas fa-satellite-dish"></i> MATCH CENTER</span>
            <span id="match-status" style="font-size: 10px; color: #fff; background: #c00; padding: 2px 6px; border-radius: 3px;">OFFLINE</span>
        </div>
        
        <div class="match-teams" style="display: flex; align-items: center; justify-content: space-between; position: relative;">
          <div class="text-center" style="flex: 1;">
             <div class="font-tech" style="font-size: 24px; font-weight: 700;">ARX</div>
             <div style="font-size: 10px; color: var(--text-gray);">Airex Team</div>
          </div>
          <div style="font-family: var(--font-tech); font-size: 20px; color: var(--accent); font-style: italic;">VS</div>
          <div class="text-center" style="flex: 1;">
            <div class="font-tech" style="font-size: 24px; font-weight: 700;" id="enemy-name-display">TBA</div>
            <div style="font-size: 10px; color: var(--text-gray);">Opponent</div>
          </div>
        </div>

        <div id="countdown" class="countdown">
           <span style="font-size: 12px; color: #666; align-self: center;">ОЖИДАНИЕ АНОНСА...</span>
        </div>
      </div> 

      <div class="card">
          <h3 class="font-tech" style="font-size: 14px; margin-top: 0; margin-bottom: 15px; color: #fff;">
              <i class="fas fa-bolt text-accent"></i> ПОСЛЕДНИЕ СОБЫТИЯ
          </h3>
          <div id="home-news-feed">
             <div class="text-center" style="font-size: 12px; color: #666; padding: 20px;">Загрузка данных...</div>
          </div>
          <button class="btn-glitch btn-secondary" onclick="selectTab('news', document.getElementById('btn-news'))" style="margin-top:10px;">
            АРХИВ НОВОСТЕЙ
          </button>
      </div>

     <div class="card text-center" style="background: linear-gradient(45deg, rgba(255,0,76,0.1), transparent);">
      <h3 class="font-tech" style="font-size: 16px;">SUPPORT TEAM</h3>
      <a href="https://dalink.to/airex_team_esports" target="_blank" class="btn-glitch" style="background: var(--accent); border: none; width: auto; display: inline-flex; margin-top: 10px;">
        <i class="fas fa-heart" style="margin-right: 8px;"></i> ОТПРАВИТЬ ДОНАТ
      </a>
    </div>
    </section>

    <section id="team">
      <div class="text-center" style="margin-bottom: 30px;">
        <h2 class="font-tech text-accent">MAIN ROSTER</h2>
      </div>
      <div class="roster-grid" id="dynamic-roster"></div>
      
      <div class="text-center" style="margin: 50px 0 30px 0;">
        <h2 class="font-tech" style="color: #666;">RESERVE</h2>
      </div>
      <div class="roster-grid" id="dynamic-roster-reserve"></div>
    </section>

    <section id="practice">
    <div class="card">
        <div class="card-header">
            <span class="card-title"><i class="fas fa-crosshairs" style="color:var(--accent)"></i> ЗАПИСЬ НА ПРАК (CW)</span>
            <span style="font-size: 10px; background: rgba(255,0,76,0.2); padding: 4px 8px; border-radius: 4px; color: var(--accent); font-weight: 700;">BO1 ONLY</span>
        </div>
        
        <p style="font-size: 11px; color: #666; margin-bottom: 20px;">Выберите удобное время из доступных слотов и заполните данные вашей команды.</p>

        <form id="prac-form" onsubmit="submitPrac(event)">
            <div class="form-group" style="background: rgba(255, 255, 255, 0.02); border: 1px solid #222; padding: 15px; border-radius: 8px;">
                <label class="form-label" style="color: var(--accent);">1. ВЫБЕРИТЕ ВРЕМЯ (МСК)</label>
                <select id="prac-slot-select" class="form-input" required>
                    <option value="" disabled selected>Загрузка расписания...</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">НАЗВАНИЕ ВАШЕГО КЛАНА</label>
                <input type="text" id="pc-clan" class="form-input" placeholder="Напр: AIREX TEAM" required>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                    <label class="form-label">НИК КАПИТАНА</label>
                    <input type="text" id="pc-cap" class="form-input" placeholder="Nick" required>
                </div>
                <div class="form-group">
                    <label class="form-label">ID КАПИТАНА</label>
                    <input type="number" id="pc-id" class="form-input" placeholder="12345678" required>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">КОНТАКТ ДЛЯ СВЯЗИ (TG)</label>
                <input type="text" id="pc-contact" class="form-input" placeholder="@username" required>
            </div>

            <div class="form-group">
                <label class="form-label">ЖЕЛАЕМЫЕ КАРТЫ (ВЫБЕРИТЕ МИНИМУМ ОДНУ)</label>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 10px; margin-top: 10px;">
                   <label class="map-label"><input type="checkbox" class="map-check" value="Sandstone"> Sandstone</label>
                   <label class="map-label"><input type="checkbox" class="map-check" value="Rust"> Rust</label>
                   <label class="map-label"><input type="checkbox" class="map-check" value="Dune"> Dune</label>
                   <label class="map-label"><input type="checkbox" class="map-check" value="Province"> Province</label>
                   <label class="map-label"><input type="checkbox" class="map-check" value="Breeze"> Breeze</label>
                   <label class="map-label"><input type="checkbox" class="map-check" value="Zone 9"> Zone 9</label>
                  <label class="map-label"><input type="checkbox" class="map-check" value="Zone 9"> Hanami</label>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">СОСТАВ (5 ИГРОКОВ)</label>
                <textarea id="pc-lineup" class="form-input" rows="2" placeholder="Nick1, Nick2, Nick3..."></textarea>
            </div>

            <input type="hidden" id="pc-format" value="BO1">

            <button type="submit" class="btn-glitch" style="margin-top: 10px; width: 100%;">ЗАБРОНИРОВАТЬ МАТЧ</button>
        </form>
    </div>
    
    <div class="card">
        <div class="card-header">
            <span class="card-title">ПОДТВЕРЖДЕННЫЕ МАТЧИ</span>
        </div>
        <div id="public-booked-list">
            </div>
    </div>
</section>

<style>
/* Стили специально для карт в форме */
.map-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 11px;
    color: #888;
    cursor: pointer;
    background: rgba(255,255,255,0.02);
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #111;
    transition: 0.3s;
}
.map-label:hover {
    border-color: #333;
    color: #fff;
}
.map-check:checked + label {
    border-color: var(--accent);
}
</style>


    <section id="about">
       <div class="card">
           <h3 class="font-tech text-center">HISTORY & ROADMAP</h3>
           <div class="roadmap-container" id="roadmap-container" style="position: relative; padding-left: 20px; margin-top: 20px;">
               <div class="text-center" style="color: #666; font-size: 12px;">Загрузка истории...</div>
           </div>
       </div>
       <div class="card text-center">
        <h3>SOCIAL LINKS</h3>
        <div style="font-size: 32px; display: flex; justify-content: center; gap: 20px; margin-top: 15px;">
          <a href="https://t.me/airex_team_esports" class="text-accent"><i class="fab fa-telegram"></i></a>
          <a href="https://www.tiktok.com/@airex_team" class="text-accent"><i class="fab fa-tiktok"></i></a>
          <a href="https://youtube.com/@airex_team.official" class="text-accent"><i class="fab fa-youtube"></i></a>
        </div>
       </div>
    </section>

    <section id="news">
      <div class="text-center" style="margin-bottom: 20px;">
        <h2 class="font-tech">NEWS FEED</h2>
      </div>
      <div id="dynamic-news-container"></div>
    </section>

    <section id="media">
        <div class="card">
          <h3 class="font-tech">LATEST VIDEO</h3>
          <div id="video-container" style="position: relative; width: 100%; padding-bottom: 56.25%; background: #000; border-radius: 8px;">
             </div>
        </div>
        <div class="card">
          <h3 class="font-tech">GALLERY</h3>
          <div class="gallery-grid" id="gallery-container" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px;"></div>
        </div> 
    </section>

    <section id="history">
    <div style="text-align: center; margin-bottom: 25px;">
        <h2 style="font-family: var(--font-tech); color: #fff;">MATCH HISTORY</h2>
    </div>
    
    <div id="full-history-container">
        <div style="text-align:center; padding:20px; color:#666;">Загрузка истории...</div>
    </div>
</section>


    <section id="reviews">
        <div class="card">
            <h3 class="font-tech">ОСТАВИТЬ ОТЗЫВ</h3>
            <form id="review-form" onsubmit="window.submitReview(event)">
                <div class="form-group">
                    <input type="text" id="rev-nick" class="form-input" placeholder="Ваш ник" required>
                </div>
                <div class="form-group">
                    <select id="rev-target" class="form-input">
                        <option value="Команде">Всей команде</option>
                        <option value="Капитану">Капитану</option>
                        <option value="Менеджеру">Менеджеру</option>
                    </select>
                </div>
                <div class="form-group">
                    <textarea id="rev-text" class="form-input" placeholder="Сообщение..." required></textarea>
                </div>
                <button type="submit" class="btn-glitch">ОТПРАВИТЬ</button>
            </form>
        </div>
        <div id="reviews-container"></div>
    </section>
  
      <section id="schedule">
        <div class="text-center" style="margin-bottom: 30px;">
            <h2 class="font-tech text-accent">WEEKLY OPS</h2>
            <p style="font-size: 11px; color: #666; letter-spacing: 1px;">ОПЕРАТИВНОЕ РАСПИСАНИЕ КОМАНДЫ (МСК)</p>
        </div>

        <div class="schedule-grid" id="dynamic-schedule-grid">
    <div class="text-center" style="grid-column: 1/-1; padding: 20px; color: #666; font-size: 11px;">
        Загрузка расписания...
    </div>
</div>
    </section>

    <section id="join">
      <div class="card">
        <div class="text-center">
            <h2 class="font-tech text-accent">JOIN REQUEST</h2>
            <p style="font-size: 12px; color: #888;">Заявка будет отправлена в Telegram штаба.</p>
        </div>
        <form onsubmit="sendToTelegram(event)" autocomplete="off" style="margin-top: 20px;">
          
          <div class="form-group">
            <label class="form-label">Ник</label>
            <input type="text" id="nick" class="form-input" placeholder="Ваш никнейм" required>
          </div>

          <div class="form-group">
            <label class="form-label">Отыгранные часы</label>
            <input type="number" id="hours" class="form-input" placeholder="Кол-во часов" required>
          </div>

          <div class="form-group">
            <label class="form-label">Ваша роль</label>
            <select id="role" class="form-input">
                <option>Капитан</option>
                <option>Люркер</option>
                <option>Опен Фрагер</option>
                <option>Энтри фрагер</option>
                <option>Саппорт</option>
                <option>Рифлер</option>
                <option>Снайпер</option>
            </select>
          </div>

          <div class="form-group">
             <label class="form-label">Ваш наилучший ранг в ММ</label>
             <input type="text" id="best_rank" class="form-input" placeholder="Например: Elite" required>
          </div>

          <div class="form-group">
            <label class="form-label">Ваш TG</label>
            <input type="text" id="tg_username" class="form-input" placeholder="@username" required>
          </div>

          <button type="submit" class="btn-glitch">ОТПРАВИТЬ ЗАЯВКУ</button>
        </form>
      </div>
    </section>


    <footer style="text-align: center; color: #444; font-size: 9px; font-family: var(--font-tech); text-transform: uppercase; margin-top: 40px;">
        <p>&copy; 2026 AIREX TEAM - Оффициальный сайт команды</p>
    </footer>

</div>

<div id="notify-container" style="position: fixed; top: 90px; right: 20px; z-index: 10000; display: flex; flex-direction: column; gap: 10px; pointer-events: none;"></div>

<script type="module">
// 1. ОЧИСТКА URL
if (window.location.pathname.endsWith('index.html')) {
    const cleanPath = window.location.pathname.replace('index.html', '');
    window.history.replaceState({}, document.title, cleanPath);
}

// 2. ТЕЛЕГРАМ КОНФИГ
const TG_CONFIG = {
    token: "8350126335:AAEGBd3ASBvZVVG9qeFseWlpdlZpznTEe1s", 
    channelId: "-1003511221408", 
    groupId: "-1003774094781"    
};
// === НАСТРОЙКИ ЗАЩИТЫ (ANTI-SPAM SYSTEM) ===

// 1. Черный список слов (нижний регистр)
const BLACKLIST = [
    "дай", "gold", "голд", "голды", "дайте", "промо", "промокод", 
    "скин", "нож", "аркана", "standoff", "стандофф", "стендофф",
    "маты", "хуй", "пизд", "ебал", "бля", "чмо", "лох", "даун", 
    "сука", "урод", "мамк", "мать", "админ дай", "бесплатно"
];

// 2. Функция проверки текста на запрещенку
function containsSpam(text) {
    if (!text) return false;
    const lower = text.toLowerCase();
    return BLACKLIST.some(word => lower.includes(word));
}

// 3. Проверка кулдауна (чтобы не спамили каждые 5 секунд)
// timeInMinutes - сколько минут ждать перед следующей отправкой
function checkCooldown(key, timeInMinutes) {
    const lastTime = localStorage.getItem(key);
    if (!lastTime) return true;
    
    const diff = Date.now() - parseInt(lastTime);
    const minutesPassed = diff / 60000;
    
    return minutesPassed >= timeInMinutes;
}

// 4. Установка кулдауна
function setCooldown(key) {
    localStorage.setItem(key, Date.now());
}

// 3. ФУНКЦИЯ УВЕДОМЛЕНИЙ (Была пропущена)
window.showNotify = (text, type) => {
    const container = document.getElementById('notify-container');
    if (!container) return;
    const notif = document.createElement('div');
    notif.className = `hud-toast active`;
    notif.style.borderLeftColor = type === 'error' ? 'red' : 'var(--success)';
    notif.innerHTML = `
        <i class="${type === 'error' ? 'fas fa-exclamation-triangle' : 'fas fa-check-circle'}"></i>
        <span>${text}</span>
    `;
    container.appendChild(notif);
    
    // Удаляем через 3 сек
    setTimeout(() => {
        notif.style.opacity = '0';
        notif.style.transform = 'translateX(120%)';
        setTimeout(() => notif.remove(), 500);
    }, 3000);
};

// 4. УНИВЕРСАЛЬНАЯ ОТПРАВКА (ИСПРАВЛЕННАЯ ПОД HTML)
async function sendToBot(chatId, message) {
    try {
        const response = await fetch(`https://api.telegram.org/bot${TG_CONFIG.token}/sendMessage`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                chat_id: chatId,
                text: message,
                parse_mode: 'HTML', // ВАЖНО: HTML режим, чтобы не было ошибок с "_"
                disable_web_page_preview: true
            })
        });
        const res = await response.json();
        if(!res.ok) throw new Error(res.description);
    } catch (e) {
        console.error("TG Send Error:", e);
        throw e;
    }
}

// 5. FIREBASE IMPORTS & CONFIG
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getFirestore, doc, onSnapshot, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyDVFYaxAtzEi5zF8yi_ORJQYL66wQa-gpE", 
    authDomain: "airexsite.firebaseapp.com",
    projectId: "airexsite",
    storageBucket: "airexsite.firebasestorage.app",
    messagingSenderId: "276640665598",
    appId: "1:276640665598:web:d7400bd5962995efb43aaf"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Защита от HTML-инъекций
const escapeHTML = (str) => {
    if (!str) return "";
    return str.replace(/[&<>'"]/g, 
        tag => ({
            '&': '&amp;', '<': '&lt;', '>': '&gt;', "'": '&#39;', '"': '&quot;'
        }[tag]));
};

// 6. UI ЛОГИКА (PRELOADER, TABS, TYPEWRITER)
window.addEventListener('load', () => {
    const preloader = document.getElementById('preloader');
    setTimeout(() => {
        if(preloader) {
            preloader.style.opacity = '0';
            setTimeout(() => preloader.remove(), 500);
        }
        typeWriter();
    }, 800);
});

function typeWriter() {
    const text = "STANDOFF 2 PROFESSIONAL TEAM";
    let i = 0;
    const el = document.getElementById('typing-text');
    if(!el) return;
    el.innerHTML = "";
    function type() {
        if (i < text.length) {
            el.innerHTML += text.charAt(i);
            i++;
            setTimeout(type, 80);
        }
    }
    type();
}

window.selectTab = (tabId, btn) => {
    document.querySelectorAll('section').forEach(s => { 
        s.classList.remove('active'); 
        setTimeout(() => { if(!s.classList.contains('active')) s.style.opacity = '0'; }, 400);
    });

    const target = document.getElementById(tabId);
    if(target) { 
        target.classList.add('active');
        requestAnimationFrame(() => { target.style.opacity = '1'; });
    }
    
    document.querySelectorAll('.menu-item').forEach(i => i.classList.remove('active-tab'));
    if(btn) {
        btn.classList.add('active-tab');
        if(btn.classList.contains('has-update')) {
            btn.classList.remove('has-update');
            localStorage.setItem('last_seen_' + tabId, Date.now());
        }
    }

    const dropdown = document.getElementById('navDropdown');
    const menuBtn = document.getElementById('menuBtn');
    if(dropdown) dropdown.classList.remove('active');
    if(menuBtn) menuBtn.classList.remove('active');
    window.scrollTo(0, 0);
};

window.toggleMenu = () => {
    const dd = document.getElementById('navDropdown');
    const btn = document.getElementById('menuBtn');
    if(dd) dd.classList.toggle('active');
    if(btn) btn.classList.toggle('active');
};

function checkUpdateBadge(key, latestId, btnId) {
    const lastSeen = parseInt(localStorage.getItem('last_seen_' + key) || '0');
    const btn = document.getElementById(btnId);
    if (btn) {
        if(latestId > lastSeen) btn.classList.add('has-update');
        else btn.classList.remove('has-update');
    }
}

// 7. FIREBASE ЛОГИКА (НОВОСТИ, МАТЧИ, СОСТАВ)

// --- NEWS ---
onSnapshot(doc(db, "siteData", "news"), (snap) => {
    const list = (snap.exists() && snap.data().list) ? snap.data().list : [];
    
    const homeFeed = document.getElementById('home-news-feed');
    if(homeFeed) {
        if(!list.length) homeFeed.innerHTML = '<div class="text-center" style="font-size:10px; padding:20px;">Нет новостей</div>';
        else {
            homeFeed.innerHTML = list.slice(0, 3).map(n => `
                <div class="news-card-home" onclick="selectTab('news', document.getElementById('btn-news'))" style="cursor:pointer;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                        <span style="color:var(--accent); font-size:9px; font-weight:800;">${escapeHTML(n.tag || 'LIVE')}</span>
                        <span style="color: #666; font-size: 9px;">${escapeHTML(n.date)}</span>
                    </div>
                    <div style="font-family: var(--font-tech); font-size: 13px; color: #eee; line-height:1.4;">
                        ${escapeHTML(n.title)}
                    </div>
                </div>
            `).join('');
        }
    }

    const fullFeed = document.getElementById('dynamic-news-container');
    if(fullFeed) {
        fullFeed.innerHTML = list.slice().reverse().map(n => `
            <div class="card" style="border-left: 2px solid var(--accent);">
                <div style="font-size:10px; color:var(--accent); font-weight:700; margin-bottom:10px;">
                    ${escapeHTML(n.date)} <span style="color:#fff; opacity:0.5;">[${escapeHTML(n.tag || 'NEWS')}]</span>
                </div>
                <h2 style="font-family: var(--font-tech); font-size: 18px; margin: 0 0 15px 0; color: #fff;">${escapeHTML(n.title)}</h2>
                <div style="font-size: 13px; color: #ccc; line-height: 1.6; white-space: pre-wrap;">${n.text}</div> 
            </div>
        `).join('');
    }

    if(list.length > 0) {
        const latestId = Math.max(...list.map(i => i.id || 0));
        checkUpdateBadge('news', latestId, 'btn-news');
    }
});

// --- MATCH TIMER ---
let timerInterval;
onSnapshot(doc(db, "siteData", "match"), (snap) => {
    if(snap.exists()) {
        const data = snap.data();
        const enemyEl = document.getElementById('enemy-name-display');
        if(enemyEl) enemyEl.innerText = escapeHTML(data.enemy || "TBA");
        if(data.date) startTimer(data.date);
        else stopTimer("TBA");
    }
});

function stopTimer(msg) {
    if(timerInterval) clearInterval(timerInterval);
    const cdEl = document.getElementById('countdown');
    const stEl = document.getElementById('match-status');
    if(cdEl) cdEl.innerHTML = `<span style="font-size:12px; color:#666;">${msg}</span>`;
    if(stEl) { stEl.innerText = "OFFLINE"; stEl.style.background = "#333"; }
}

function startTimer(isoDate) {
    if(timerInterval) clearInterval(timerInterval);
    const target = new Date(isoDate).getTime();
    
    const update = () => {
        const now = new Date().getTime();
        const diff = target - now;
        const statusEl = document.getElementById('match-status');
        const cdEl = document.getElementById('countdown');
        if (!statusEl || !cdEl) return;
        
        if(diff < 0) {
            statusEl.innerText = "LIVE / END";
            statusEl.style.background = "var(--accent)";
            cdEl.innerHTML = "<span style='font-size:16px; font-weight:700; color:var(--accent);'>MATCH IN PROGRESS</span>";
            clearInterval(timerInterval);
            return;
        }
        
        const d = Math.floor(diff / (1000 * 60 * 60 * 24));
        const h = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const m = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        
        cdEl.innerHTML = `
           <div class="text-center"><div class="cd-num">${d}</div><div class="cd-lbl">DAYS</div></div>
           <div style="font-size:24px; padding-bottom:15px; color:#444;">:</div>
           <div class="text-center"><div class="cd-num">${h}</div><div class="cd-lbl">HRS</div></div>
           <div style="font-size:24px; padding-bottom:15px; color:#444;">:</div>
           <div class="text-center"><div class="cd-num">${m}</div><div class="cd-lbl">MIN</div></div>
        `;
        statusEl.innerText = "UPCOMING";
        statusEl.style.background = "var(--success)";
        statusEl.style.color = "#000";
    };
    update();
    timerInterval = setInterval(update, 1000);
}

// --- ROSTER (EVO CARDS) ---
// --- ОБНОВЛЕННЫЙ РОСТЕР (СИНХРОНИЗАЦИЯ С АДМИНКОЙ) ---
const renderRoster = (list, elementId) => {
    const el = document.getElementById(elementId);
    if(!el) return;
    
    if(!list || !list.length) {
        el.innerHTML = `<div style="grid-column: 1/-1; text-align: center; color: #444; padding: 40px; font-family: var(--font-tech);">DATA ENCRYPTED</div>`;
        return;
    }

    el.innerHTML = list.map(p => {
        // Безопасное получение вложенных данных
        const kd = p.stats ? p.stats.kd : '0.0';
        const rank = p.stats ? p.stats.rank : 'N/A';
        
        return `
        <div class="evo-card">
            <img src="${p.img || 'https://via.placeholder.com/400x600/111/333?text=AIREX+AGENT'}" 
                 class="evo-avatar" 
                 onerror="this.src='https://via.placeholder.com/400x600/111/333?text=ERROR'">
            
            <div class="evo-overlay"></div>

            <div class="evo-info">
                <div class="evo-role">${escapeHTML(p.role || 'MEMBER')}</div>
                <h3 class="evo-nick">${escapeHTML(p.nick)}</h3>
                <div class="evo-quote">"${escapeHTML(p.quote || 'No mercy.')}"</div>
            </div>

            <div class="evo-stats-panel">
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-val" style="color:var(--success)">${escapeHTML(String(kd))}</div>
                        <div class="stat-lbl">K/D</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-val">${escapeHTML(rank)}</div>
                        <div class="stat-lbl">RANK</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-val" style="font-size:12px;">${escapeHTML(p.device || 'Mobile')}</div>
                        <div class="stat-lbl">DEVICE</div>
                    </div>
                </div>

                <div class="extra-info" style="margin-bottom: 5px;">
                    <span>SENSITIVITY:</span>
                    <span style="color: #fff;">${escapeHTML(p.settings || 'Default')}</span>
                </div>
                <div class="extra-info">
                    <span>FAVORITE WEAPON:</span>
                    <span style="color: var(--accent);">${escapeHTML(p.weapon || 'Unknown')}</span>
                </div>
            </div>
        </div>
    `}).join('');
};

// Подписка на обновления
onSnapshot(doc(db, "siteData", "roster_main"), (s) => renderRoster(s.exists() ? s.data().list : [], 'dynamic-roster'));
onSnapshot(doc(db, "siteData", "roster_reserve"), (s) => renderRoster(s.exists() ? s.data().list : [], 'dynamic-roster-reserve'));

// --- PRACTICES (CW) SYSTEM ---
onSnapshot(doc(db, "siteData", "practices"), (snap) => {
    const select = document.getElementById('prac-slot-select');
    const publicList = document.getElementById('public-booked-list');
    
    if (!snap.exists() || !snap.data().list) return;

    const allSlots = snap.data().list;
    allSlots.sort((a, b) => new Date(a.isoDate) - new Date(b.isoDate));

    const openSlots = allSlots.filter(s => s.status === 'open' && new Date(s.isoDate) > new Date());
    if (select) {
        if (!openSlots.length) select.innerHTML = '<option disabled selected>Нет свободных слотов</option>';
        else select.innerHTML = '<option value="" disabled selected>-- Выберите время --</option>' + 
            openSlots.map(s => `<option value="${s.id}">${escapeHTML(s.displayTime)}</option>`).join('');
    }

    const bookedSlots = allSlots.filter(s => s.status === 'booked');
    if (publicList) {
        publicList.innerHTML = !bookedSlots.length 
            ? '<div style="font-size:11px; color:#555; text-align:center; padding:10px;">Расписание чисто</div>'
            : bookedSlots.map(s => `
                <div style="border-bottom: 1px solid rgba(255,255,255,0.05); padding: 10px 0;">
                    <div style="display:flex; justify-content:space-between;">
                        <span style="color:var(--accent); font-size:12px; font-weight:700;">${escapeHTML(s.displayTime)}</span>
                        <span style="font-size:10px; padding:2px 6px; background:#111; border:1px solid #333; border-radius:4px;">CONFIRMED</span>
                    </div>
                    <div style="margin-top:5px; font-size:14px; font-weight:600;">
                        VS ${escapeHTML(s.team.clanName)} 
                    </div>
                </div>
            `).join('');
    }
});

// --- ABOUT, MEDIA, REVIEWS ---
onSnapshot(doc(db, "siteData", "about"), (snap) => {
    const list = (snap.exists() && snap.data().roadmap) ? snap.data().roadmap : [];
    const cont = document.getElementById('roadmap-container');
    if(cont) {
        cont.innerHTML = '<div style="position:absolute; left:6px; top:0; bottom:0; width:2px; background:linear-gradient(180deg, var(--accent), transparent);"></div>' + 
        list.map(r => `
            <div style="position:relative; margin-bottom:25px; padding-left:15px;">
                <div style="position:absolute; left:-18px; top:2px; width:10px; height:10px; background:#000; border:2px solid var(--accent); border-radius:50%; z-index:2;"></div>
                <div style="font-size:10px; color:var(--accent); font-family:var(--font-tech);">${escapeHTML(r.date)}</div>
                <div style="font-weight:700; font-size:14px; color:#fff;">${escapeHTML(r.title)}</div>
                <div style="font-size:11px; color:#888;">${escapeHTML(r.desc)}</div>
            </div>
        `).join('');
    }
});

onSnapshot(doc(db, "siteData", "media"), (snap) => {
    if(!snap.exists()) return;
    const d = snap.data();
    if(document.getElementById('video-container') && d.videoId) {
        document.getElementById('video-container').innerHTML = `<iframe style="position:absolute; top:0; left:0; width:100%; height:100%; border:none;" src="https://www.youtube.com/embed/${d.videoId}?rel=0&modestbranding=1" allowfullscreen></iframe>`;
    }
    if(document.getElementById('gallery-container') && d.gallery) {
        document.getElementById('gallery-container').innerHTML = d.gallery.map(g => `
            <div style="background: url('${g.src}') center/cover; height: 100px; border-radius: 6px; cursor: pointer; border:1px solid #333; transition:0.3s;" onmouseover="this.style.borderColor='var(--accent)'" onmouseout="this.style.borderColor='#333'"></div>
        `).join('');
         const latest = Math.max(...d.gallery.map(i => i.id || 0));
         checkUpdateBadge('media', latest, 'btn-media');
    }
});

onSnapshot(doc(db, "siteData", "reviews"), (snap) => {
    const list = (snap.exists() && snap.data().list) ? snap.data().list : [];
    const el = document.getElementById('reviews-container');
    if(el) {
        el.innerHTML = list.slice().reverse().map(r => `
            <div style="background: rgba(255,255,255,0.02); padding: 15px; border-radius: 8px; margin-top: 10px; border: 1px solid var(--glass-border);">
                <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;">
                    <span style="color:var(--accent); font-weight:700;">${escapeHTML(r.nick)}</span>
                    <span style="color:#666;">to ${escapeHTML(r.target)}</span>
                </div>
                <div style="font-size:13px; color:#ccc; font-style:italic;">"${escapeHTML(r.text)}"</div>
            </div>
        `).join('');
    }
});

// 8. ACTION FUNCTIONS (SUBMITTING FORMS)

// === A. ЗАЯВКА В КЛАН (JOIN) ===
window.sendToTelegram = async (e) => {
    e.preventDefault();
    const btn = e.target.querySelector('button');
    const oldText = btn.innerText;
    btn.disabled = true;
    btn.innerText = "SENDING...";

    const data = {
        nick: escapeHTML(document.getElementById('nick').value),
        hours: escapeHTML(document.getElementById('hours').value),
        role: escapeHTML(document.getElementById('role').value),
        rank: escapeHTML(document.getElementById('best_rank').value),
        tg: escapeHTML(document.getElementById('tg_username').value)
    };

    try {
        const tgMsg = `📝 <b>НОВАЯ ЗАЯВКА В CLAN</b>\n\n` +
                      `👤 <b>Ник:</b> ${data.nick}\n` +
                      `⏳ <b>Часы:</b> ${data.hours}\n` +
                      `🎯 <b>Роль:</b> ${data.role}\n` +
                      `🏆 <b>Пик Ранг:</b> ${data.rank}\n` +
                      `✈️ <b>TG:</b> ${data.tg}`;

        await sendToBot(TG_CONFIG.groupId, tgMsg);
        window.showNotify("Анкета доставлена в штаб!", "success");
        e.target.reset();
    } catch (err) {
        window.showNotify("Ошибка при отправке: " + err.message, "error");
    } finally {
        btn.disabled = false;
        btn.innerText = oldText;
    }
};

// === ПОДТВЕРЖДЕНИЕ ПРАКА (ЛОГИКА) ===
// === ПОДТВЕРЖДЕНИЕ ПРАКА (С ЗАЩИТОЙ) ===
window.submitPrac = async (e) => {
    e.preventDefault();

    // 1. ЗАЩИТА ОТ ЧАСТЫХ ЗАПРОСОВ (Кулдаун 10 минут)
    if (!checkCooldown('last_prac_submit', 10)) {
        return window.showNotify("Не спамьте! Следующая заявка через 10 минут.", "error");
    }

    const slotSelect = document.getElementById('prac-slot-select');
    const slotId = parseInt(slotSelect.value);
    const maps = Array.from(document.querySelectorAll('.map-check:checked')).map(cb => cb.value);
    
    // Получаем значения полей
    const clanName = document.getElementById('pc-clan').value.trim();
    const captain = document.getElementById('pc-cap').value.trim();
    const capId = document.getElementById('pc-id').value.trim();
    const contact = document.getElementById('pc-contact').value.trim();
    const lineup = document.getElementById('pc-lineup').value.trim();

    // --- ВАЛИДАЦИЯ ДАННЫХ ---

    // 2. Проверка ID (Только цифры, от 7 до 14 символов)
    const idRegex = /^\d{7,14}$/;
    if (!idRegex.test(capId)) {
        return window.showNotify("ID должен содержать только цифры (7-14 знаков)!", "error");
    }

    // 3. Проверка Telegram (@username, англ буквы, цифры, _, длина 3-12 (расширил немного для реальности))
    // Твое требование 3-8 букв очень жесткое, я сделал 3-20, но СТРОГО на английском.
    const tgRegex = /^@[a-zA-Z0-9_]{3,20}$/;
    if (!tgRegex.test(contact)) {
        return window.showNotify("TG должен начинаться с @ и быть на английском!", "error");
    }

    // 4. Проверка на спам-слова и попрошайничество
    if (containsSpam(clanName) || containsSpam(lineup) || containsSpam(captain)) {
         // Блокируем отправку, но делаем вид, что что-то грузится (troll-защита), или просто шлем ошибку
        return window.showNotify("Обнаружены запрещенные слова или спам!", "error");
    }

    // 5. Базовая проверка выбора
    if (!slotId) return window.showNotify("Пожалуйста, выберите время!", "error");
    if (maps.length === 0) return window.showNotify("Выберите хотя бы одну карту!", "error");


    // --- ЕСЛИ ВСЕ ОК — ОТПРАВЛЯЕМ ---
    const btn = e.target.querySelector('button');
    const originalText = btn.innerText;
    
    btn.innerText = "ПРОВЕРКА...";
    btn.disabled = true;

    try {
        const ref = doc(db, "siteData", "practices");
        const snap = await getDoc(ref);
        if (!snap.exists()) throw new Error("Ошибка базы данных");

        let list = snap.data().list;
        const idx = list.findIndex(s => s.id === slotId);

        if (idx === -1 || list[idx].status !== 'open') {
            throw new Error("Этот слот уже занят!");
        }

        // Обновляем статус
        list[idx].status = 'booked';
        list[idx].team = {
            clanName: escapeHTML(clanName),
            captain: escapeHTML(captain),
            capId: escapeHTML(capId),
            contact: escapeHTML(contact),
            format: "BO1",
            maps: maps,
            lineup: escapeHTML(lineup)
        };

        await updateDoc(ref, { list: list });

        // Устанавливаем таймер блокировки (чтобы этот юзер не мог спамить заявками)
        setCooldown('last_prac_submit');

        const tgMsg = `⚔️ <b>НОВЫЙ ПРАК ЗАБРОНИРОВАН</b>\n` +
                      `────────────────────\n` +
                      `📅 <b>ВРЕМЯ:</b> <code>${list[idx].displayTime} (МСК)</code>\n` +
                      `👥 <b>КЛАН:</b> <code>${escapeHTML(clanName)}</code>\n` +
                      `👤 <b>КЭП:</b> ${escapeHTML(captain)} (ID: <code>${escapeHTML(capId)}</code>)\n` +
                      `📞 <b>СВЯЗЬ:</b> ${escapeHTML(contact)}\n` +
                      `🎮 <b>ФОРМАТ:</b> BO1\n` +
                      `🗺 <b>КАРТЫ:</b> ${maps.join(', ')}\n` +
                      `📝 <b>СОСТАВ:</b> ${escapeHTML(lineup || 'Не указан')}\n` +
                      `────────────────────`;

        await sendToBot(TG_CONFIG.channelId, tgMsg);

        window.showNotify("Слот успешно забронирован!", "success");
        e.target.reset();
        
        setTimeout(() => window.location.reload(), 1500);

    } catch (err) {
        window.showNotify(err.message, "error");
        btn.innerText = originalText;
        btn.disabled = false;
    }
};

// === C. ОТЗЫВЫ (С ЗАЩИТОЙ) ===
window.submitReview = async (e) => {
    e.preventDefault();

    // 1. Кулдаун на отзывы (30 минут)
    if (!checkCooldown('last_review_submit', 30)) {
        return window.showNotify("Вы уже отправляли отзыв недавно.", "error");
    }

    const nick = document.getElementById('rev-nick').value.trim();
    const target = document.getElementById('rev-target').value;
    const text = document.getElementById('rev-text').value.trim();

    // 2. Проверка текста
    if (text.length < 5) return window.showNotify("Отзыв слишком короткий!", "error");
    if (containsSpam(text) || containsSpam(nick)) {
        return window.showNotify("Ваш отзыв содержит спам или запрещенные слова.", "error");
    }

    try {
        const ref = doc(db, "siteData", "reviews");
        const snap = await getDoc(ref);
        if(!snap.exists()) await setDoc(ref, { list: [] });
        
        await updateDoc(ref, { list: arrayUnion({
            id: Date.now(),
            nick: escapeHTML(nick),
            target: escapeHTML(target),
            text: escapeHTML(text)
        })});

        // Блокируем повторную отправку
        setCooldown('last_review_submit');

        const tgMsg = `💬 <b>НОВЫЙ ОТЗЫВ НА САЙТЕ</b>\n\n` +
                      `👤 <b>От кого:</b> ${escapeHTML(nick)}\n` +
                      `🎯 <b>Кому:</b> ${escapeHTML(target)}\n` +
                      `📝 <b>Текст:</b> ${escapeHTML(text)}`;
        
        await sendToBot(TG_CONFIG.channelId, tgMsg);

        window.showNotify("Отзыв опубликован!", "success");
        e.target.reset();
    } catch(err) { 
        window.showNotify("Ошибка сети", "error"); 
    }
};

// 9. AMBIENT PLAYER
window.toggleAmbient = () => {
    const audio = document.getElementById('bg-music');
    const icon = document.getElementById('btn-icon');
    const status = document.getElementById('player-status');
    
    if (audio.paused) {
        audio.play().then(() => {
            icon.className = 'fas fa-pause';
            status.innerText = "PLAYING";
            status.style.color = "var(--success)";
        }).catch(() => {
            window.showNotify("Autoplay blocked. Tap again.", "error");
        });
    } else {
        audio.pause();
        icon.className = 'fas fa-play';
        status.innerText = "PAUSED";
        status.style.color = "#888";
    }
};
  // --- ЛОГИКА WIN RATE И ИСТОРИИ ---
// Слушаем базу данных (коллекция siteData, документ history)
onSnapshot(doc(db, "siteData", "history"), (snap) => {
    // Получаем массив матчей, или пустой массив если данных нет
    const list = (snap.exists() && snap.data().list) ? snap.data().list : [];
    
    // 1. ПОДСЧЕТ СТАТИСТИКИ (WIN RATE)
    let wins = 0;
    
    // Проходим по каждому матчу
    list.forEach(m => { 
        // Если наш счет больше их счета, то это победа
        if(parseInt(m.our) > parseInt(m.their)) {
            wins++;
        }
    });

    const total = list.length; // Всего игр
    // Считаем процент: (Победы / Всего) * 100. Если игр 0, то процент 0.
    const rate = total > 0 ? Math.round((wins / total) * 100) : 0;
    
    // Обновляем цифры на Главной странице
    const wrEl = document.getElementById('win-rate-display');
    const totEl = document.getElementById('total-games-display');
    
    if(wrEl) wrEl.innerText = `${rate}%`; // Ставим процент
    if(totEl) totEl.innerText = total;    // Ставим кол-во игр

    // 2. ОТРИСОВКА СПИСКА ИСТОРИИ (В раздел Матчи)
    const cont = document.getElementById('full-history-container');
    
    if(cont) {
        if (list.length === 0) {
            cont.innerHTML = '<div style="text-align:center; padding:20px; color:#555;">Игр пока не было</div>';
        } else {
            // slice().reverse() чтобы новые матчи были сверху
            cont.innerHTML = list.slice().reverse().map(m => {
                // Определяем, победа это или поражение
                const isWin = parseInt(m.our) > parseInt(m.their);
                // Цвет рамки и текста (Зеленый или Красный)
                const color = isWin ? '#00ffa3' : '#ff004c'; 
                const statusText = isWin ? 'VICTORY' : 'DEFEAT';

                return `
                <div class="card" style="padding: 15px; border-left: 3px solid ${color}; display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;">
                    <div>
                        <div style="font-size: 9px; color: #888; text-transform: uppercase; margin-bottom: 4px;">
                            ${m.tour || 'Match'} </div>
                        <div style="font-family: var(--font-tech); font-size: 14px; font-weight: 700; color: #fff;">
                            VS ${m.enemy} </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-family: var(--font-tech); font-size: 20px; font-weight: 700; color: ${color};">
                            ${m.our} : ${m.their}
                        </div>
                        <div style="font-size: 9px; color: ${color}; font-weight: 700;">
                            ${statusText}
                        </div>
                    </div>
                </div>`;
            }).join('');
        }
    }
});
  
// --- SCHEDULE SYSTEM (РАСПИСАНИЕ) ---
onSnapshot(doc(db, "siteData", "schedule"), (snap) => {
    const grid = document.getElementById('dynamic-schedule-grid');
    if (!grid) return;

    const list = (snap.exists() && snap.data().list) ? snap.data().list : [];

    if (list.length === 0) {
        grid.innerHTML = '<div class="text-center" style="grid-column: 1/-1; padding: 20px; color: #666;">Расписание пусто</div>';
        return;
    }

    // 1. Группируем события по Дню (чтобы события одного дня были в одной карточке)
    // Мы используем название дня (например "MON / ПН") как ключ
    const groupedData = {};
    
    // Сортируем список, чтобы события шли по порядку добавления (или по ID)
    list.sort((a, b) => a.id - b.id);

    list.forEach(item => {
        // Если такой день еще не создавали в списке, создаем пустой массив
        if (!groupedData[item.day]) {
            groupedData[item.day] = [];
        }
        groupedData[item.day].push(item);
    });

    // 2. Очищаем сетку перед отрисовкой
    grid.innerHTML = '';

    // 3. Проходимся по каждому дню и рисуем карточку
    // Object.keys(groupedData) дает нам список дней, которые мы собрали
    Object.keys(groupedData).forEach(dayName => {
        const events = groupedData[dayName];
        
        // Генерируем HTML для каждого события внутри дня
        const eventsHtml = events.map(ev => {
            // Определяем цвет полоски слева
            let typeClass = 'type-rest'; // серый по умолчанию
            let badgeHtml = '';
            
            const txt = ev.event.toLowerCase();
            // Простая логика определения типа по тексту события
            if(txt.includes('прак') || txt.includes('cw') || txt.includes('game')) {
                typeClass = 'type-pracc';
                badgeHtml = '<span class="tag-badge bg-pracc">CW</span>';
            } else if(txt.includes('турнир') || txt.includes('cup') || txt.includes('tour')) {
                typeClass = 'type-tour';
                badgeHtml = '<span class="tag-badge bg-tour">CUP</span>';
            } else if(txt.includes('трен') || txt.includes('train')) {
                typeClass = 'type-train';
                badgeHtml = '<span class="tag-badge bg-train">TRAIN</span>';
            }

            // Статусы (завершено/отмена)
            let statusStyle = '';
            if(ev.status === 'done') statusStyle = 'opacity: 0.5; filter: grayscale(1); text-decoration: line-through;';
            if(ev.status === 'canceled') statusStyle = 'border-left-color: red; opacity: 0.7;';

            return `
            <div class="event-item ${typeClass}" style="${statusStyle}">
                <span class="event-time">${escapeHTML(ev.time)}</span>
                <div class="event-info">
                    <span class="event-name">${escapeHTML(ev.event)}</span>
                </div>
                ${badgeHtml}
            </div>
            `;
        }).join('');

        // Проверяем, "Сегодня" ли это (просто по наличию слова Today в названии дня, если ты его напишешь)
        // Или можно просто всегда рисовать стандартную карточку.
        // Добавим проверку: если день называется так же, как текущий день недели (сложно реализовать универсально),
        // поэтому просто рисуем карточку.
        
        grid.innerHTML += `
        <div class="day-card">
            <div class="day-header">
                <span class="day-title">${escapeHTML(dayName)}</span>
            </div>
            <div class="events-list">
                ${eventsHtml}
            </div>
        </div>
        `;
    });
});

</script>


</body>
</html>

